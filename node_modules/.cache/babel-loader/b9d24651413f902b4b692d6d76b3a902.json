{"ast":null,"code":"/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { assert } from '../util/assert.js';\nimport { interpolateFunction, stringifyFunction } from '../util/Function.js';\nimport { QueryHandler } from './QueryHandler.js';\nimport { scriptInjector } from './ScriptInjector.js';\n/**\n * The registry of {@link CustomQueryHandler | custom query handlers}.\n *\n * @example\n *\n * ```ts\n * Puppeteer.customQueryHandlers.register('lit', { … });\n * const aHandle = await page.$('lit/…');\n * ```\n *\n * @internal\n */\nexport class CustomQueryHandlerRegistry {\n  #handlers = new Map();\n  get(name) {\n    const handler = this.#handlers.get(name);\n    return handler ? handler[1] : undefined;\n  }\n  /**\n   * Registers a {@link CustomQueryHandler | custom query handler}.\n   *\n   * @remarks\n   * After registration, the handler can be used everywhere where a selector is\n   * expected by prepending the selection string with `<name>/`. The name is\n   * only allowed to consist of lower- and upper case latin letters.\n   *\n   * @example\n   *\n   * ```ts\n   * Puppeteer.customQueryHandlers.register('lit', { … });\n   * const aHandle = await page.$('lit/…');\n   * ```\n   *\n   * @param name - Name to register under.\n   * @param queryHandler - {@link CustomQueryHandler | Custom query handler} to\n   * register.\n   */\n  register(name, handler) {\n    assert(!this.#handlers.has(name), `Cannot register over existing handler: ${name}`);\n    assert(/^[a-zA-Z]+$/.test(name), `Custom query handler names may only contain [a-zA-Z]`);\n    assert(handler.queryAll || handler.queryOne, `At least one query method must be implemented.`);\n    const Handler = class extends QueryHandler {\n      static querySelectorAll = interpolateFunction((node, selector, PuppeteerUtil) => {\n        return PuppeteerUtil.customQuerySelectors.get(PLACEHOLDER('name')).querySelectorAll(node, selector);\n      }, {\n        name: JSON.stringify(name)\n      });\n      static querySelector = interpolateFunction((node, selector, PuppeteerUtil) => {\n        return PuppeteerUtil.customQuerySelectors.get(PLACEHOLDER('name')).querySelector(node, selector);\n      }, {\n        name: JSON.stringify(name)\n      });\n    };\n    const registerScript = interpolateFunction(PuppeteerUtil => {\n      PuppeteerUtil.customQuerySelectors.register(PLACEHOLDER('name'), {\n        queryAll: PLACEHOLDER('queryAll'),\n        queryOne: PLACEHOLDER('queryOne')\n      });\n    }, {\n      name: JSON.stringify(name),\n      queryAll: handler.queryAll ? stringifyFunction(handler.queryAll) : String(undefined),\n      queryOne: handler.queryOne ? stringifyFunction(handler.queryOne) : String(undefined)\n    }).toString();\n    this.#handlers.set(name, [registerScript, Handler]);\n    scriptInjector.append(registerScript);\n  }\n  /**\n   * Unregisters the {@link CustomQueryHandler | custom query handler} for the\n   * given name.\n   *\n   * @throws `Error` if there is no handler under the given name.\n   */\n  unregister(name) {\n    const handler = this.#handlers.get(name);\n    if (!handler) {\n      throw new Error(`Cannot unregister unknown handler: ${name}`);\n    }\n    scriptInjector.pop(handler[0]);\n    this.#handlers.delete(name);\n  }\n  /**\n   * Gets the names of all {@link CustomQueryHandler | custom query handlers}.\n   */\n  names() {\n    return [...this.#handlers.keys()];\n  }\n  /**\n   * Unregisters all custom query handlers.\n   */\n  clear() {\n    for (const [registerScript] of this.#handlers) {\n      scriptInjector.pop(registerScript);\n    }\n    this.#handlers.clear();\n  }\n}\n/**\n * @internal\n */\nexport const customQueryHandlers = new CustomQueryHandlerRegistry();\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.registerCustomQueryHandler}\n *\n * @public\n */\nexport function registerCustomQueryHandler(name, handler) {\n  customQueryHandlers.register(name, handler);\n}\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.unregisterCustomQueryHandler}\n *\n * @public\n */\nexport function unregisterCustomQueryHandler(name) {\n  customQueryHandlers.unregister(name);\n}\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.customQueryHandlerNames}\n *\n * @public\n */\nexport function customQueryHandlerNames() {\n  return customQueryHandlers.names();\n}\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.clearCustomQueryHandlers}\n *\n * @public\n */\nexport function clearCustomQueryHandlers() {\n  customQueryHandlers.clear();\n}","map":{"version":3,"mappings":"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","names":["assert","interpolateFunction","stringifyFunction","QueryHandler","scriptInjector","CustomQueryHandlerRegistry","Map","get","name","handler","undefined","register","has","test","queryAll","queryOne","Handler","querySelectorAll","node","selector","PuppeteerUtil","customQuerySelectors","PLACEHOLDER","JSON","stringify","querySelector","registerScript","String","toString","set","append","unregister","Error","pop","delete","names","keys","clear","customQueryHandlers","registerCustomQueryHandler","unregisterCustomQueryHandler","customQueryHandlerNames","clearCustomQueryHandlers"],"sources":["D:\\Julieth-Campos\\PSO\\node_modules\\puppeteer-core\\src\\common\\CustomQueryHandler.ts"],"sourcesContent":["/**\n * Copyright 2023 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type PuppeteerUtil from '../injected/injected.js';\nimport {assert} from '../util/assert.js';\nimport {interpolateFunction, stringifyFunction} from '../util/Function.js';\n\nimport {\n  QueryHandler,\n  type QuerySelector,\n  type QuerySelectorAll,\n} from './QueryHandler.js';\nimport {scriptInjector} from './ScriptInjector.js';\n\n/**\n * @public\n */\nexport interface CustomQueryHandler {\n  /**\n   * Searches for a {@link https://developer.mozilla.org/en-US/docs/Web/API/Node | Node} matching the given `selector` from {@link https://developer.mozilla.org/en-US/docs/Web/API/Node | node}.\n   */\n  queryOne?: (node: Node, selector: string) => Node | null;\n  /**\n   * Searches for some {@link https://developer.mozilla.org/en-US/docs/Web/API/Node | Nodes} matching the given `selector` from {@link https://developer.mozilla.org/en-US/docs/Web/API/Node | node}.\n   */\n  queryAll?: (node: Node, selector: string) => Iterable<Node>;\n}\n\n/**\n * The registry of {@link CustomQueryHandler | custom query handlers}.\n *\n * @example\n *\n * ```ts\n * Puppeteer.customQueryHandlers.register('lit', { … });\n * const aHandle = await page.$('lit/…');\n * ```\n *\n * @internal\n */\nexport class CustomQueryHandlerRegistry {\n  #handlers = new Map<\n    string,\n    [registerScript: string, Handler: typeof QueryHandler]\n  >();\n\n  get(name: string): typeof QueryHandler | undefined {\n    const handler = this.#handlers.get(name);\n    return handler ? handler[1] : undefined;\n  }\n\n  /**\n   * Registers a {@link CustomQueryHandler | custom query handler}.\n   *\n   * @remarks\n   * After registration, the handler can be used everywhere where a selector is\n   * expected by prepending the selection string with `<name>/`. The name is\n   * only allowed to consist of lower- and upper case latin letters.\n   *\n   * @example\n   *\n   * ```ts\n   * Puppeteer.customQueryHandlers.register('lit', { … });\n   * const aHandle = await page.$('lit/…');\n   * ```\n   *\n   * @param name - Name to register under.\n   * @param queryHandler - {@link CustomQueryHandler | Custom query handler} to\n   * register.\n   */\n  register(name: string, handler: CustomQueryHandler): void {\n    assert(\n      !this.#handlers.has(name),\n      `Cannot register over existing handler: ${name}`\n    );\n    assert(\n      /^[a-zA-Z]+$/.test(name),\n      `Custom query handler names may only contain [a-zA-Z]`\n    );\n    assert(\n      handler.queryAll || handler.queryOne,\n      `At least one query method must be implemented.`\n    );\n\n    const Handler = class extends QueryHandler {\n      static override querySelectorAll: QuerySelectorAll = interpolateFunction(\n        (node, selector, PuppeteerUtil) => {\n          return PuppeteerUtil.customQuerySelectors\n            .get(PLACEHOLDER('name'))!\n            .querySelectorAll(node, selector);\n        },\n        {name: JSON.stringify(name)}\n      );\n      static override querySelector: QuerySelector = interpolateFunction(\n        (node, selector, PuppeteerUtil) => {\n          return PuppeteerUtil.customQuerySelectors\n            .get(PLACEHOLDER('name'))!\n            .querySelector(node, selector);\n        },\n        {name: JSON.stringify(name)}\n      );\n    };\n    const registerScript = interpolateFunction(\n      (PuppeteerUtil: PuppeteerUtil) => {\n        PuppeteerUtil.customQuerySelectors.register(PLACEHOLDER('name'), {\n          queryAll: PLACEHOLDER('queryAll'),\n          queryOne: PLACEHOLDER('queryOne'),\n        });\n      },\n      {\n        name: JSON.stringify(name),\n        queryAll: handler.queryAll\n          ? stringifyFunction(handler.queryAll)\n          : String(undefined),\n        queryOne: handler.queryOne\n          ? stringifyFunction(handler.queryOne)\n          : String(undefined),\n      }\n    ).toString();\n\n    this.#handlers.set(name, [registerScript, Handler]);\n    scriptInjector.append(registerScript);\n  }\n\n  /**\n   * Unregisters the {@link CustomQueryHandler | custom query handler} for the\n   * given name.\n   *\n   * @throws `Error` if there is no handler under the given name.\n   */\n  unregister(name: string): void {\n    const handler = this.#handlers.get(name);\n    if (!handler) {\n      throw new Error(`Cannot unregister unknown handler: ${name}`);\n    }\n    scriptInjector.pop(handler[0]);\n    this.#handlers.delete(name);\n  }\n\n  /**\n   * Gets the names of all {@link CustomQueryHandler | custom query handlers}.\n   */\n  names(): string[] {\n    return [...this.#handlers.keys()];\n  }\n\n  /**\n   * Unregisters all custom query handlers.\n   */\n  clear(): void {\n    for (const [registerScript] of this.#handlers) {\n      scriptInjector.pop(registerScript);\n    }\n    this.#handlers.clear();\n  }\n}\n\n/**\n * @internal\n */\nexport const customQueryHandlers = new CustomQueryHandlerRegistry();\n\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.registerCustomQueryHandler}\n *\n * @public\n */\nexport function registerCustomQueryHandler(\n  name: string,\n  handler: CustomQueryHandler\n): void {\n  customQueryHandlers.register(name, handler);\n}\n\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.unregisterCustomQueryHandler}\n *\n * @public\n */\nexport function unregisterCustomQueryHandler(name: string): void {\n  customQueryHandlers.unregister(name);\n}\n\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.customQueryHandlerNames}\n *\n * @public\n */\nexport function customQueryHandlerNames(): string[] {\n  return customQueryHandlers.names();\n}\n\n/**\n * @deprecated Import {@link Puppeteer} and use the static method\n * {@link Puppeteer.clearCustomQueryHandlers}\n *\n * @public\n */\nexport function clearCustomQueryHandlers(): void {\n  customQueryHandlers.clear();\n}\n"]},"metadata":{},"sourceType":"module"}