{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.data = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst stream_1 = require(\"stream\");\nconst crypto_1 = require(\"crypto\");\nconst data_uri_to_buffer_1 = require(\"data-uri-to-buffer\");\nconst notmodified_1 = __importDefault(require(\"./notmodified\"));\nconst debug = (0, debug_1.default)('get-uri:data');\nclass DataReadable extends stream_1.Readable {\n  constructor(hash, buf) {\n    super();\n    this.push(buf);\n    this.push(null);\n    this.hash = hash;\n  }\n}\n/**\n * Returns a Readable stream from a \"data:\" URI.\n */\nconst data = async function (_ref) {\n  let {\n    href: uri\n  } = _ref;\n  let {\n    cache\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  // need to create a SHA1 hash of the URI string, for cacheability checks\n  // in future `getUri()` calls with the same data URI passed in.\n  const shasum = (0, crypto_1.createHash)('sha1');\n  shasum.update(uri);\n  const hash = shasum.digest('hex');\n  debug('generated SHA1 hash for \"data:\" URI: %o', hash);\n  // check if the cache is the same \"data:\" URI that was previously passed in.\n  if (cache?.hash === hash) {\n    debug('got matching cache SHA1 hash: %o', hash);\n    throw new notmodified_1.default();\n  } else {\n    debug('creating Readable stream from \"data:\" URI buffer');\n    const {\n      buffer\n    } = (0, data_uri_to_buffer_1.dataUriToBuffer)(uri);\n    return new DataReadable(hash, Buffer.from(buffer));\n  }\n};\nexports.data = data;","map":{"version":3,"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAEA,MAAMA,KAAK,GAAG,mBAAW,EAAC,cAAc,CAAC;AAEzC,MAAMC,YAAa,SAAQC,iBAAQ;EAGlCC,YAAYC,IAAY,EAAEC,GAAW;IACpC,KAAK,EAAE;IACP,IAAI,CAACC,IAAI,CAACD,GAAG,CAAC;IACd,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC;IACf,IAAI,CAACF,IAAI,GAAGA,IAAI;EACjB;;AAOD;;;AAGO,MAAMG,IAAI,GAAgC,sBAG7C;EAAA,IAFH;IAAEC,IAAI,EAAEC;EAAG,CAAE;EAAA,IACb;IAAEC;EAAK,CAAE,uEAAG,EAAE;EAEd;EACA;EACA,MAAMC,MAAM,GAAG,uBAAU,EAAC,MAAM,CAAC;EACjCA,MAAM,CAACC,MAAM,CAACH,GAAG,CAAC;EAClB,MAAML,IAAI,GAAGO,MAAM,CAACE,MAAM,CAAC,KAAK,CAAC;EACjCb,KAAK,CAAC,yCAAyC,EAAEI,IAAI,CAAC;EAEtD;EACA,IAAIM,KAAK,EAAEN,IAAI,KAAKA,IAAI,EAAE;IACzBJ,KAAK,CAAC,kCAAkC,EAAEI,IAAI,CAAC;IAC/C,MAAM,IAAIU,qBAAgB,EAAE;GAC5B,MAAM;IACNd,KAAK,CAAC,kDAAkD,CAAC;IACzD,MAAM;MAAEe;IAAM,CAAE,GAAG,wCAAe,EAACN,GAAG,CAAC;IACvC,OAAO,IAAIR,YAAY,CAACG,IAAI,EAAEY,MAAM,CAACC,IAAI,CAACF,MAAM,CAAC,CAAC;;AAEpD,CAAC;AApBYG,YAAI","names":["debug","DataReadable","stream_1","constructor","hash","buf","push","data","href","uri","cache","shasum","update","digest","notmodified_1","buffer","Buffer","from","exports"],"sources":["../src/data.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}