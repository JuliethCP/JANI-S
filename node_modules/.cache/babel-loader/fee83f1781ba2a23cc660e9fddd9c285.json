{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ExplorerSync = void 0;\nconst fs_1 = __importDefault(require(\"fs\"));\nconst path_1 = __importDefault(require(\"path\"));\nconst path_type_1 = require(\"path-type\");\nconst ExplorerBase_js_1 = require(\"./ExplorerBase.js\");\nconst loaders_js_1 = require(\"./loaders.js\");\nconst util_js_1 = require(\"./util.js\");\n/**\n * @internal\n */\nclass ExplorerSync extends ExplorerBase_js_1.ExplorerBase {\n  load(filepath) {\n    filepath = path_1.default.resolve(filepath);\n    const load = () => {\n      return this.config.transform(this.#readConfiguration(filepath));\n    };\n    if (this.loadCache) {\n      return (0, util_js_1.emplace)(this.loadCache, filepath, load);\n    }\n    return load();\n  }\n  search() {\n    let from = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    if (this.config.metaConfigFilePath) {\n      this.loadingMetaConfig = true;\n      const config = this.load(this.config.metaConfigFilePath);\n      this.loadingMetaConfig = false;\n      if (config && !config.isEmpty) {\n        return config;\n      }\n    }\n    const stopDir = path_1.default.resolve(this.config.stopDir);\n    from = path_1.default.resolve(from);\n    const search = () => {\n      /* istanbul ignore if -- @preserve */\n      if ((0, path_type_1.isDirectorySync)(from)) {\n        for (const place of this.config.searchPlaces) {\n          const filepath = path_1.default.join(from, place);\n          try {\n            const result = this.#readConfiguration(filepath);\n            if (result !== null && !(result.isEmpty && this.config.ignoreEmptySearchPlaces)) {\n              return this.config.transform(result);\n            }\n          } catch (error) {\n            if (error.code === 'ENOENT' || error.code === 'EISDIR' || error.code === 'ENOTDIR') {\n              continue;\n            }\n            throw error;\n          }\n        }\n      }\n      const dir = path_1.default.dirname(from);\n      if (from !== stopDir && from !== dir) {\n        from = dir;\n        if (this.searchCache) {\n          return (0, util_js_1.emplace)(this.searchCache, from, search);\n        }\n        return search();\n      }\n      return this.config.transform(null);\n    };\n    if (this.searchCache) {\n      return (0, util_js_1.emplace)(this.searchCache, from, search);\n    }\n    return search();\n  }\n  #readConfiguration(filepath) {\n    const contents = fs_1.default.readFileSync(filepath, 'utf8');\n    return this.toCosmiconfigResult(filepath, this.#loadConfiguration(filepath, contents));\n  }\n  #loadConfiguration(filepath, contents) {\n    if (contents.trim() === '') {\n      return;\n    }\n    if (path_1.default.basename(filepath) === 'package.json') {\n      return (0, util_js_1.getPropertyByPath)((0, loaders_js_1.loadJson)(filepath, contents), this.config.packageProp) ?? null;\n    }\n    const extension = path_1.default.extname(filepath);\n    try {\n      const loader = this.config.loaders[extension || 'noExt'] ?? this.config.loaders['default'];\n      if (loader !== undefined) {\n        return loader(filepath, contents);\n      }\n    } catch (error) {\n      error.filepath = filepath;\n      throw error;\n    }\n    throw new Error(`No loader specified for ${(0, ExplorerBase_js_1.getExtensionDescription)(extension)}`);\n  }\n  /**\n   * @deprecated Use {@link ExplorerSync.prototype.load}.\n   */\n  /* istanbul ignore next */\n  loadSync(filepath) {\n    return this.load(filepath);\n  }\n  /**\n   * @deprecated Use {@link ExplorerSync.prototype.search}.\n   */\n  /* istanbul ignore next */\n  searchSync() {\n    let from = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    return this.search(from);\n  }\n}\nexports.ExplorerSync = ExplorerSync;","map":{"version":3,"mappings":"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","names":["ExplorerSync","ExplorerBase_js_1","load","filepath","path_1","resolve","config","transform","loadCache","search","from","metaConfigFilePath","loadingMetaConfig","isEmpty","stopDir","place","searchPlaces","join","result","ignoreEmptySearchPlaces","error","code","dir","dirname","searchCache","contents","fs_1","readFileSync","toCosmiconfigResult","trim","basename","packageProp","extension","extname","loader","loaders","undefined","Error","loadSync","searchSync","exports"],"sources":["../src/ExplorerSync.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}