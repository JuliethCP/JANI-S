{"ast":null,"code":"/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { map, NEVER, timer, firstValueFrom, fromEvent, filterAsync, from, raceWith } from '../../third_party/rxjs/rxjs.js';\nimport { isNode } from '../environment.js';\nimport { assert } from '../util/assert.js';\nimport { isErrorLike } from '../util/ErrorLike.js';\nimport { debug } from './Debug.js';\nimport { TimeoutError } from './Errors.js';\n/**\n * @internal\n */\nexport const debugError = debug('puppeteer:error');\n/**\n * @internal\n */\nexport function createEvaluationError(details) {\n  let name;\n  let message;\n  if (!details.exception) {\n    name = 'Error';\n    message = details.text;\n  } else if ((details.exception.type !== 'object' || details.exception.subtype !== 'error') && !details.exception.objectId) {\n    return valueFromRemoteObject(details.exception);\n  } else {\n    const detail = getErrorDetails(details);\n    name = detail.name;\n    message = detail.message;\n  }\n  const messageHeight = message.split('\\n').length;\n  const error = new Error(message);\n  error.name = name;\n  const stackLines = error.stack.split('\\n');\n  const messageLines = stackLines.splice(0, messageHeight);\n  // The first line is this function which we ignore.\n  stackLines.shift();\n  if (details.stackTrace && stackLines.length < Error.stackTraceLimit) {\n    for (const frame of details.stackTrace.callFrames.reverse()) {\n      if (PuppeteerURL.isPuppeteerURL(frame.url) && frame.url !== PuppeteerURL.INTERNAL_URL) {\n        const url = PuppeteerURL.parse(frame.url);\n        stackLines.unshift(`    at ${frame.functionName || url.functionName} (${url.functionName} at ${url.siteString}, <anonymous>:${frame.lineNumber}:${frame.columnNumber})`);\n      } else {\n        stackLines.push(`    at ${frame.functionName || '<anonymous>'} (${frame.url}:${frame.lineNumber}:${frame.columnNumber})`);\n      }\n      if (stackLines.length >= Error.stackTraceLimit) {\n        break;\n      }\n    }\n  }\n  error.stack = [...messageLines, ...stackLines].join('\\n');\n  return error;\n}\n/**\n * @internal\n */\nexport function createClientError(details) {\n  let name;\n  let message;\n  if (!details.exception) {\n    name = 'Error';\n    message = details.text;\n  } else if ((details.exception.type !== 'object' || details.exception.subtype !== 'error') && !details.exception.objectId) {\n    return valueFromRemoteObject(details.exception);\n  } else {\n    const detail = getErrorDetails(details);\n    name = detail.name;\n    message = detail.message;\n  }\n  const error = new Error(message);\n  error.name = name;\n  const messageHeight = error.message.split('\\n').length;\n  const messageLines = error.stack.split('\\n').splice(0, messageHeight);\n  const stackLines = [];\n  if (details.stackTrace) {\n    for (const frame of details.stackTrace.callFrames) {\n      // Note we need to add `1` because the values are 0-indexed.\n      stackLines.push(`    at ${frame.functionName || '<anonymous>'} (${frame.url}:${frame.lineNumber + 1}:${frame.columnNumber + 1})`);\n      if (stackLines.length >= Error.stackTraceLimit) {\n        break;\n      }\n    }\n  }\n  error.stack = [...messageLines, ...stackLines].join('\\n');\n  return error;\n}\nconst getErrorDetails = details => {\n  let name = '';\n  let message;\n  const lines = details.exception?.description?.split('\\n    at ') ?? [];\n  const size = Math.min(details.stackTrace?.callFrames.length ?? 0, lines.length - 1);\n  lines.splice(-size, size);\n  if (details.exception?.className) {\n    name = details.exception.className;\n  }\n  message = lines.join('\\n');\n  if (name && message.startsWith(`${name}: `)) {\n    message = message.slice(name.length + 2);\n  }\n  return {\n    message,\n    name\n  };\n};\n/**\n * @internal\n */\nconst SOURCE_URL = Symbol('Source URL for Puppeteer evaluation scripts');\n/**\n * @internal\n */\nexport class PuppeteerURL {\n  static INTERNAL_URL = 'pptr:internal';\n  static fromCallSite(functionName, site) {\n    const url = new PuppeteerURL();\n    url.#functionName = functionName;\n    url.#siteString = site.toString();\n    return url;\n  }\n  static parse = url => {\n    url = url.slice('pptr:'.length);\n    const [functionName = '', siteString = ''] = url.split(';');\n    const puppeteerUrl = new PuppeteerURL();\n    puppeteerUrl.#functionName = functionName;\n    puppeteerUrl.#siteString = decodeURIComponent(siteString);\n    return puppeteerUrl;\n  };\n  static isPuppeteerURL = url => {\n    return url.startsWith('pptr:');\n  };\n  #functionName;\n  #siteString;\n  get functionName() {\n    return this.#functionName;\n  }\n  get siteString() {\n    return this.#siteString;\n  }\n  toString() {\n    return `pptr:${[this.#functionName, encodeURIComponent(this.#siteString)].join(';')}`;\n  }\n}\n/**\n * @internal\n */\nexport const withSourcePuppeteerURLIfNone = (functionName, object) => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object;\n  }\n  const original = Error.prepareStackTrace;\n  Error.prepareStackTrace = (_, stack) => {\n    // First element is the function.\n    // Second element is the caller of this function.\n    // Third element is the caller of the caller of this function\n    // which is precisely what we want.\n    return stack[2];\n  };\n  const site = new Error().stack;\n  Error.prepareStackTrace = original;\n  return Object.assign(object, {\n    [SOURCE_URL]: PuppeteerURL.fromCallSite(functionName, site)\n  });\n};\n/**\n * @internal\n */\nexport const getSourcePuppeteerURLIfAvailable = object => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object[SOURCE_URL];\n  }\n  return undefined;\n};\n/**\n * @internal\n */\nexport function valueFromRemoteObject(remoteObject) {\n  assert(!remoteObject.objectId, 'Cannot extract value when objectId is given');\n  if (remoteObject.unserializableValue) {\n    if (remoteObject.type === 'bigint') {\n      return BigInt(remoteObject.unserializableValue.replace('n', ''));\n    }\n    switch (remoteObject.unserializableValue) {\n      case '-0':\n        return -0;\n      case 'NaN':\n        return NaN;\n      case 'Infinity':\n        return Infinity;\n      case '-Infinity':\n        return -Infinity;\n      default:\n        throw new Error('Unsupported unserializable value: ' + remoteObject.unserializableValue);\n    }\n  }\n  return remoteObject.value;\n}\n/**\n * @internal\n */\nexport const isString = obj => {\n  return typeof obj === 'string' || obj instanceof String;\n};\n/**\n * @internal\n */\nexport const isNumber = obj => {\n  return typeof obj === 'number' || obj instanceof Number;\n};\n/**\n * @internal\n */\nexport const isPlainObject = obj => {\n  return typeof obj === 'object' && obj?.constructor === Object;\n};\n/**\n * @internal\n */\nexport const isRegExp = obj => {\n  return typeof obj === 'object' && obj?.constructor === RegExp;\n};\n/**\n * @internal\n */\nexport const isDate = obj => {\n  return typeof obj === 'object' && obj?.constructor === Date;\n};\n/**\n * @internal\n */\nexport function evaluationString(fun) {\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n  if (isString(fun)) {\n    assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n  function serializeArgument(arg) {\n    if (Object.is(arg, undefined)) {\n      return 'undefined';\n    }\n    return JSON.stringify(arg);\n  }\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n/**\n * @internal\n */\nexport function addPageBinding(type, name) {\n  // This is the CDP binding.\n  // @ts-expect-error: In a different context.\n  const callCdp = globalThis[name];\n  // We replace the CDP binding with a Puppeteer binding.\n  Object.assign(globalThis, {\n    [name]() {\n      // This is the Puppeteer binding.\n      // @ts-expect-error: In a different context.\n      const callPuppeteer = globalThis[name];\n      callPuppeteer.args ??= new Map();\n      callPuppeteer.callbacks ??= new Map();\n      const seq = (callPuppeteer.lastSeq ?? 0) + 1;\n      callPuppeteer.lastSeq = seq;\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      callPuppeteer.args.set(seq, args);\n      callCdp(JSON.stringify({\n        type,\n        name,\n        seq,\n        args,\n        isTrivial: !args.some(value => {\n          return value instanceof Node;\n        })\n      }));\n      return new Promise((resolve, reject) => {\n        callPuppeteer.callbacks.set(seq, {\n          resolve(value) {\n            callPuppeteer.args.delete(seq);\n            resolve(value);\n          },\n          reject(value) {\n            callPuppeteer.args.delete(seq);\n            reject(value);\n          }\n        });\n      });\n    }\n  });\n}\n/**\n * @internal\n */\nexport function pageBindingInitString(type, name) {\n  return evaluationString(addPageBinding, type, name);\n}\n/**\n * @internal\n */\nlet fs = null;\n/**\n * @internal\n */\nexport async function importFSPromises() {\n  if (!fs) {\n    try {\n      fs = await import('fs/promises');\n    } catch (error) {\n      if (error instanceof TypeError) {\n        throw new Error('Cannot write to a path outside of a Node-like environment.');\n      }\n      throw error;\n    }\n  }\n  return fs;\n}\n/**\n * @internal\n */\nexport async function getReadableAsBuffer(readable, path) {\n  const buffers = [];\n  if (path) {\n    const fs = await importFSPromises();\n    const fileHandle = await fs.open(path, 'w+');\n    try {\n      for await (const chunk of readable) {\n        buffers.push(chunk);\n        await fileHandle.writeFile(chunk);\n      }\n    } finally {\n      await fileHandle.close();\n    }\n  } else {\n    for await (const chunk of readable) {\n      buffers.push(chunk);\n    }\n  }\n  try {\n    return Buffer.concat(buffers);\n  } catch (error) {\n    return null;\n  }\n}\n/**\n * @internal\n */\nexport async function getReadableFromProtocolStream(client, handle) {\n  // TODO: Once Node 18 becomes the lowest supported version, we can migrate to\n  // ReadableStream.\n  if (!isNode) {\n    throw new Error('Cannot create a stream outside of Node.js environment.');\n  }\n  const {\n    Readable\n  } = await import('stream');\n  let eof = false;\n  return new Readable({\n    async read(size) {\n      if (eof) {\n        return;\n      }\n      try {\n        const response = await client.send('IO.read', {\n          handle,\n          size\n        });\n        this.push(response.data, response.base64Encoded ? 'base64' : undefined);\n        if (response.eof) {\n          eof = true;\n          await client.send('IO.close', {\n            handle\n          });\n          this.push(null);\n        }\n      } catch (error) {\n        if (isErrorLike(error)) {\n          this.destroy(error);\n          return;\n        }\n        throw error;\n      }\n    }\n  });\n}\n/**\n * @internal\n */\nexport async function setPageContent(page, content) {\n  // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n  // lifecycle event. @see https://crrev.com/608658\n  return await page.evaluate(html => {\n    document.open();\n    document.write(html);\n    document.close();\n  }, content);\n}\n/**\n * @internal\n */\nexport function getPageContent() {\n  let content = '';\n  for (const node of document.childNodes) {\n    switch (node) {\n      case document.documentElement:\n        content += document.documentElement.outerHTML;\n        break;\n      default:\n        content += new XMLSerializer().serializeToString(node);\n        break;\n    }\n  }\n  return content;\n}\n/**\n * @internal\n */\nexport function validateDialogType(type) {\n  let dialogType = null;\n  const validDialogTypes = new Set(['alert', 'confirm', 'prompt', 'beforeunload']);\n  if (validDialogTypes.has(type)) {\n    dialogType = type;\n  }\n  assert(dialogType, `Unknown javascript dialog type: ${type}`);\n  return dialogType;\n}\n/**\n * @internal\n */\nexport function timeout(ms) {\n  return ms === 0 ? NEVER : timer(ms).pipe(map(() => {\n    throw new TimeoutError(`Timed out after waiting ${ms}ms`);\n  }));\n}\n/**\n * @internal\n */\nexport const UTILITY_WORLD_NAME = '__puppeteer_utility_world__';\n/**\n * @internal\n */\nexport const SOURCE_URL_REGEX = /^[\\040\\t]*\\/\\/[@#] sourceURL=\\s*(\\S*?)\\s*$/m;\n/**\n * @internal\n */\nexport function getSourceUrlComment(url) {\n  return `//# sourceURL=${url}`;\n}\n/**\n * @internal\n */\nexport async function waitForHTTP(networkManager, eventName, urlOrPredicate, /** Time after the function will timeout */\nms, cancelation) {\n  return await firstValueFrom(fromEvent(networkManager, eventName).pipe(filterAsync(async http => {\n    if (isString(urlOrPredicate)) {\n      return urlOrPredicate === http.url();\n    }\n    if (typeof urlOrPredicate === 'function') {\n      return !!(await urlOrPredicate(http));\n    }\n    return false;\n  }), raceWith(timeout(ms), from(cancelation.valueOrThrow()))));\n}\n/**\n * @internal\n */\nexport const NETWORK_IDLE_TIME = 500;","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;AAqBA,SACEA,GAAG,EACHC,KAAK,EACLC,KAAK,EAELC,cAAc,EACdC,SAAS,EACTC,WAAW,EACXC,IAAI,EACJC,QAAQ,QACH,gCAAgC;AAGvC,SAAQC,MAAM,QAAO,mBAAmB;AACxC,SAAQC,MAAM,QAAO,mBAAmB;AAExC,SAAQC,WAAW,QAAO,sBAAsB;AAEhD,SAAQC,KAAK,QAAO,YAAY;AAChC,SAAQC,YAAY,QAAO,aAAa;AAIxC;;;AAGA,OAAO,MAAMC,UAAU,GAAGF,KAAK,CAAC,iBAAiB,CAAC;AAElD;;;AAGA,OAAM,SAAUG,qBAAqB,CACnCC,OAA0C;EAE1C,IAAIC,IAAY;EAChB,IAAIC,OAAe;EACnB,IAAI,CAACF,OAAO,CAACG,SAAS,EAAE;IACtBF,IAAI,GAAG,OAAO;IACdC,OAAO,GAAGF,OAAO,CAACI,IAAI;GACvB,MAAM,IACL,CAACJ,OAAO,CAACG,SAAS,CAACE,IAAI,KAAK,QAAQ,IAClCL,OAAO,CAACG,SAAS,CAACG,OAAO,KAAK,OAAO,KACvC,CAACN,OAAO,CAACG,SAAS,CAACI,QAAQ,EAC3B;IACA,OAAOC,qBAAqB,CAACR,OAAO,CAACG,SAAS,CAAC;GAChD,MAAM;IACL,MAAMM,MAAM,GAAGC,eAAe,CAACV,OAAO,CAAC;IACvCC,IAAI,GAAGQ,MAAM,CAACR,IAAI;IAClBC,OAAO,GAAGO,MAAM,CAACP,OAAO;;EAE1B,MAAMS,aAAa,GAAGT,OAAO,CAACU,KAAK,CAAC,IAAI,CAAC,CAACC,MAAM;EAChD,MAAMC,KAAK,GAAG,IAAIC,KAAK,CAACb,OAAO,CAAC;EAChCY,KAAK,CAACb,IAAI,GAAGA,IAAI;EACjB,MAAMe,UAAU,GAAGF,KAAK,CAACG,KAAM,CAACL,KAAK,CAAC,IAAI,CAAC;EAC3C,MAAMM,YAAY,GAAGF,UAAU,CAACG,MAAM,CAAC,CAAC,EAAER,aAAa,CAAC;EAExD;EACAK,UAAU,CAACI,KAAK,EAAE;EAClB,IAAIpB,OAAO,CAACqB,UAAU,IAAIL,UAAU,CAACH,MAAM,GAAGE,KAAK,CAACO,eAAe,EAAE;IACnE,KAAK,MAAMC,KAAK,IAAIvB,OAAO,CAACqB,UAAU,CAACG,UAAU,CAACC,OAAO,EAAE,EAAE;MAC3D,IACEC,YAAY,CAACC,cAAc,CAACJ,KAAK,CAACK,GAAG,CAAC,IACtCL,KAAK,CAACK,GAAG,KAAKF,YAAY,CAACG,YAAY,EACvC;QACA,MAAMD,GAAG,GAAGF,YAAY,CAACI,KAAK,CAACP,KAAK,CAACK,GAAG,CAAC;QACzCZ,UAAU,CAACe,OAAO,CAChB,UAAUR,KAAK,CAACS,YAAY,IAAIJ,GAAG,CAACI,YAAY,KAC9CJ,GAAG,CAACI,YACN,OAAOJ,GAAG,CAACK,UAAU,iBAAiBV,KAAK,CAACW,UAAU,IACpDX,KAAK,CAACY,YACR,GAAG,CACJ;OACF,MAAM;QACLnB,UAAU,CAACoB,IAAI,CACb,UAAUb,KAAK,CAACS,YAAY,IAAI,aAAa,KAAKT,KAAK,CAACK,GAAG,IACzDL,KAAK,CAACW,UACR,IAAIX,KAAK,CAACY,YAAY,GAAG,CAC1B;;MAEH,IAAInB,UAAU,CAACH,MAAM,IAAIE,KAAK,CAACO,eAAe,EAAE;QAC9C;;;;EAKNR,KAAK,CAACG,KAAK,GAAG,CAAC,GAAGC,YAAY,EAAE,GAAGF,UAAU,CAAC,CAACqB,IAAI,CAAC,IAAI,CAAC;EACzD,OAAOvB,KAAK;AACd;AAEA;;;AAGA,OAAM,SAAUwB,iBAAiB,CAC/BtC,OAA0C;EAE1C,IAAIC,IAAY;EAChB,IAAIC,OAAe;EACnB,IAAI,CAACF,OAAO,CAACG,SAAS,EAAE;IACtBF,IAAI,GAAG,OAAO;IACdC,OAAO,GAAGF,OAAO,CAACI,IAAI;GACvB,MAAM,IACL,CAACJ,OAAO,CAACG,SAAS,CAACE,IAAI,KAAK,QAAQ,IAClCL,OAAO,CAACG,SAAS,CAACG,OAAO,KAAK,OAAO,KACvC,CAACN,OAAO,CAACG,SAAS,CAACI,QAAQ,EAC3B;IACA,OAAOC,qBAAqB,CAACR,OAAO,CAACG,SAAS,CAAC;GAChD,MAAM;IACL,MAAMM,MAAM,GAAGC,eAAe,CAACV,OAAO,CAAC;IACvCC,IAAI,GAAGQ,MAAM,CAACR,IAAI;IAClBC,OAAO,GAAGO,MAAM,CAACP,OAAO;;EAE1B,MAAMY,KAAK,GAAG,IAAIC,KAAK,CAACb,OAAO,CAAC;EAChCY,KAAK,CAACb,IAAI,GAAGA,IAAI;EAEjB,MAAMU,aAAa,GAAGG,KAAK,CAACZ,OAAO,CAACU,KAAK,CAAC,IAAI,CAAC,CAACC,MAAM;EACtD,MAAMK,YAAY,GAAGJ,KAAK,CAACG,KAAM,CAACL,KAAK,CAAC,IAAI,CAAC,CAACO,MAAM,CAAC,CAAC,EAAER,aAAa,CAAC;EAEtE,MAAMK,UAAU,GAAG,EAAE;EACrB,IAAIhB,OAAO,CAACqB,UAAU,EAAE;IACtB,KAAK,MAAME,KAAK,IAAIvB,OAAO,CAACqB,UAAU,CAACG,UAAU,EAAE;MACjD;MACAR,UAAU,CAACoB,IAAI,CACb,UAAUb,KAAK,CAACS,YAAY,IAAI,aAAa,KAAKT,KAAK,CAACK,GAAG,IACzDL,KAAK,CAACW,UAAU,GAAG,CACrB,IAAIX,KAAK,CAACY,YAAY,GAAG,CAAC,GAAG,CAC9B;MACD,IAAInB,UAAU,CAACH,MAAM,IAAIE,KAAK,CAACO,eAAe,EAAE;QAC9C;;;;EAKNR,KAAK,CAACG,KAAK,GAAG,CAAC,GAAGC,YAAY,EAAE,GAAGF,UAAU,CAAC,CAACqB,IAAI,CAAC,IAAI,CAAC;EACzD,OAAOvB,KAAK;AACd;AAEA,MAAMJ,eAAe,GAAIV,OAA0C,IAAI;EACrE,IAAIC,IAAI,GAAG,EAAE;EACb,IAAIC,OAAe;EACnB,MAAMqC,KAAK,GAAGvC,OAAO,CAACG,SAAS,EAAEqC,WAAW,EAAE5B,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE;EACtE,MAAM6B,IAAI,GAAGC,IAAI,CAACC,GAAG,CACnB3C,OAAO,CAACqB,UAAU,EAAEG,UAAU,CAACX,MAAM,IAAI,CAAC,EAC1C0B,KAAK,CAAC1B,MAAM,GAAG,CAAC,CACjB;EACD0B,KAAK,CAACpB,MAAM,CAAC,CAACsB,IAAI,EAAEA,IAAI,CAAC;EACzB,IAAIzC,OAAO,CAACG,SAAS,EAAEyC,SAAS,EAAE;IAChC3C,IAAI,GAAGD,OAAO,CAACG,SAAS,CAACyC,SAAS;;EAEpC1C,OAAO,GAAGqC,KAAK,CAACF,IAAI,CAAC,IAAI,CAAC;EAC1B,IAAIpC,IAAI,IAAIC,OAAO,CAAC2C,UAAU,CAAC,GAAG5C,IAAI,IAAI,CAAC,EAAE;IAC3CC,OAAO,GAAGA,OAAO,CAAC4C,KAAK,CAAC7C,IAAI,CAACY,MAAM,GAAG,CAAC,CAAC;;EAE1C,OAAO;IAACX,OAAO;IAAED;EAAI,CAAC;AACxB,CAAC;AAED;;;AAGA,MAAM8C,UAAU,GAAGC,MAAM,CAAC,6CAA6C,CAAC;AAExE;;;AAGA,OAAM,MAAOtB,YAAY;EACvB,OAAOG,YAAY,GAAG,eAAe;EAErC,OAAOoB,YAAY,CACjBjB,YAAoB,EACpBkB,IAAqB;IAErB,MAAMtB,GAAG,GAAG,IAAIF,YAAY,EAAE;IAC9BE,GAAG,CAAC,aAAa,GAAGI,YAAY;IAChCJ,GAAG,CAAC,WAAW,GAAGsB,IAAI,CAACC,QAAQ,EAAE;IACjC,OAAOvB,GAAG;EACZ;EAEA,OAAOE,KAAK,GAAIF,GAAW,IAAkB;IAC3CA,GAAG,GAAGA,GAAG,CAACkB,KAAK,CAAC,OAAO,CAACjC,MAAM,CAAC;IAC/B,MAAM,CAACmB,YAAY,GAAG,EAAE,EAAEC,UAAU,GAAG,EAAE,CAAC,GAAGL,GAAG,CAAChB,KAAK,CAAC,GAAG,CAAC;IAC3D,MAAMwC,YAAY,GAAG,IAAI1B,YAAY,EAAE;IACvC0B,YAAY,CAAC,aAAa,GAAGpB,YAAY;IACzCoB,YAAY,CAAC,WAAW,GAAGC,kBAAkB,CAACpB,UAAU,CAAC;IACzD,OAAOmB,YAAY;EACrB,CAAC;EAED,OAAOzB,cAAc,GAAIC,GAAW,IAAa;IAC/C,OAAOA,GAAG,CAACiB,UAAU,CAAC,OAAO,CAAC;EAChC,CAAC;EAED,aAAa;EACb,WAAW;EAEX,IAAIb,YAAY;IACd,OAAO,IAAI,CAAC,aAAa;EAC3B;EAEA,IAAIC,UAAU;IACZ,OAAO,IAAI,CAAC,WAAW;EACzB;EAEAkB,QAAQ;IACN,OAAO,QAAQ,CACb,IAAI,CAAC,aAAa,EAClBG,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,CACrC,CAACjB,IAAI,CAAC,GAAG,CAAC,EAAE;EACf;;AAGF;;;AAGA,OAAO,MAAMkB,4BAA4B,GAAG,CAC1CvB,YAAoB,EACpBwB,MAAS,KACJ;EACL,IAAIC,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACJ,MAAM,EAAET,UAAU,CAAC,EAAE;IAC5D,OAAOS,MAAM;;EAEf,MAAMK,QAAQ,GAAG9C,KAAK,CAAC+C,iBAAiB;EACxC/C,KAAK,CAAC+C,iBAAiB,GAAG,CAACC,CAAC,EAAE9C,KAAK,KAAI;IACrC;IACA;IACA;IACA;IACA,OAAOA,KAAK,CAAC,CAAC,CAAC;EACjB,CAAC;EACD,MAAMiC,IAAI,GAAG,IAAInC,KAAK,EAAE,CAACE,KAAmC;EAC5DF,KAAK,CAAC+C,iBAAiB,GAAGD,QAAQ;EAClC,OAAOJ,MAAM,CAACO,MAAM,CAACR,MAAM,EAAE;IAC3B,CAACT,UAAU,GAAGrB,YAAY,CAACuB,YAAY,CAACjB,YAAY,EAAEkB,IAAI;GAC3D,CAAC;AACJ,CAAC;AAED;;;AAGA,OAAO,MAAMe,gCAAgC,GAG3CT,MAAS,IACmB;EAC5B,IAAIC,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACJ,MAAM,EAAET,UAAU,CAAC,EAAE;IAC5D,OAAOS,MAAM,CAACT,UAAqB,CAAiB;;EAEtD,OAAOmB,SAAS;AAClB,CAAC;AAED;;;AAGA,OAAM,SAAU1D,qBAAqB,CACnC2D,YAA2C;EAE3CzE,MAAM,CAAC,CAACyE,YAAY,CAAC5D,QAAQ,EAAE,6CAA6C,CAAC;EAC7E,IAAI4D,YAAY,CAACC,mBAAmB,EAAE;IACpC,IAAID,YAAY,CAAC9D,IAAI,KAAK,QAAQ,EAAE;MAClC,OAAOgE,MAAM,CAACF,YAAY,CAACC,mBAAmB,CAACE,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;;IAElE,QAAQH,YAAY,CAACC,mBAAmB;MACtC,KAAK,IAAI;QACP,OAAO,CAAC,CAAC;MACX,KAAK,KAAK;QACR,OAAOG,GAAG;MACZ,KAAK,UAAU;QACb,OAAOC,QAAQ;MACjB,KAAK,WAAW;QACd,OAAO,CAACA,QAAQ;MAClB;QACE,MAAM,IAAIzD,KAAK,CACb,oCAAoC,GAClCoD,YAAY,CAACC,mBAAmB,CACnC;IAAC;;EAGR,OAAOD,YAAY,CAACM,KAAK;AAC3B;AAEA;;;AAGA,OAAO,MAAMC,QAAQ,GAAIC,GAAY,IAAmB;EACtD,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,YAAYC,MAAM;AACzD,CAAC;AAED;;;AAGA,OAAO,MAAMC,QAAQ,GAAIF,GAAY,IAAmB;EACtD,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,YAAYG,MAAM;AACzD,CAAC;AAED;;;AAGA,OAAO,MAAMC,aAAa,GAAIJ,GAAY,IAAiC;EACzE,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,EAAEK,WAAW,KAAKvB,MAAM;AAC/D,CAAC;AAED;;;AAGA,OAAO,MAAMwB,QAAQ,GAAIN,GAAY,IAAmB;EACtD,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,EAAEK,WAAW,KAAKE,MAAM;AAC/D,CAAC;AAED;;;AAGA,OAAO,MAAMC,MAAM,GAAIR,GAAY,IAAiB;EAClD,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,EAAEK,WAAW,KAAKI,IAAI;AAC7D,CAAC;AAED;;;AAGA,OAAM,SAAUC,gBAAgB,CAC9BC,GAAsB,EACJ;EAAA,kCAAfC,IAAe;IAAfA,IAAe;EAAA;EAElB,IAAIb,QAAQ,CAACY,GAAG,CAAC,EAAE;IACjB5F,MAAM,CAAC6F,IAAI,CAAC1E,MAAM,KAAK,CAAC,EAAE,yCAAyC,CAAC;IACpE,OAAOyE,GAAG;;EAGZ,SAASE,iBAAiB,CAACC,GAAY;IACrC,IAAIhC,MAAM,CAACiC,EAAE,CAACD,GAAG,EAAEvB,SAAS,CAAC,EAAE;MAC7B,OAAO,WAAW;;IAEpB,OAAOyB,IAAI,CAACC,SAAS,CAACH,GAAG,CAAC;EAC5B;EAEA,OAAO,IAAIH,GAAG,KAAKC,IAAI,CAACtG,GAAG,CAACuG,iBAAiB,CAAC,CAACnD,IAAI,CAAC,GAAG,CAAC,GAAG;AAC7D;AAEA;;;AAGA,OAAM,SAAUwD,cAAc,CAACxF,IAAY,EAAEJ,IAAY;EACvD;EACA;EACA,MAAM6F,OAAO,GAAGC,UAAU,CAAC9F,IAAI,CAAC;EAEhC;EACAwD,MAAM,CAACO,MAAM,CAAC+B,UAAU,EAAE;IACxB,CAAC9F,IAAI,IAAoB;MACvB;MACA;MACA,MAAM+F,aAAa,GAAGD,UAAU,CAAC9F,IAAI,CAAC;MACtC+F,aAAa,CAACT,IAAI,KAAK,IAAIU,GAAG,EAAE;MAChCD,aAAa,CAACE,SAAS,KAAK,IAAID,GAAG,EAAE;MAErC,MAAME,GAAG,GAAG,CAACH,aAAa,CAACI,OAAO,IAAI,CAAC,IAAI,CAAC;MAC5CJ,aAAa,CAACI,OAAO,GAAGD,GAAG;MAAC,mCARpBZ,IAAe;QAAfA,IAAe;MAAA;MASvBS,aAAa,CAACT,IAAI,CAACc,GAAG,CAACF,GAAG,EAAEZ,IAAI,CAAC;MAEjCO,OAAO,CACLH,IAAI,CAACC,SAAS,CAAC;QACbvF,IAAI;QACJJ,IAAI;QACJkG,GAAG;QACHZ,IAAI;QACJe,SAAS,EAAE,CAACf,IAAI,CAACgB,IAAI,CAAC9B,KAAK,IAAG;UAC5B,OAAOA,KAAK,YAAY+B,IAAI;QAC9B,CAAC;OACF,CAAC,CACH;MAED,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAI;QACrCX,aAAa,CAACE,SAAS,CAACG,GAAG,CAACF,GAAG,EAAE;UAC/BO,OAAO,CAACjC,KAAc;YACpBuB,aAAa,CAACT,IAAI,CAACqB,MAAM,CAACT,GAAG,CAAC;YAC9BO,OAAO,CAACjC,KAAK,CAAC;UAChB,CAAC;UACDkC,MAAM,CAAClC,KAAe;YACpBuB,aAAa,CAACT,IAAI,CAACqB,MAAM,CAACT,GAAG,CAAC;YAC9BQ,MAAM,CAAClC,KAAK,CAAC;UACf;SACD,CAAC;MACJ,CAAC,CAAC;IACJ;GACD,CAAC;AACJ;AAEA;;;AAGA,OAAM,SAAUoC,qBAAqB,CAACxG,IAAY,EAAEJ,IAAY;EAC9D,OAAOoF,gBAAgB,CAACQ,cAAc,EAAExF,IAAI,EAAEJ,IAAI,CAAC;AACrD;AAEA;;;AAGA,IAAI6G,EAAE,GAAqB,IAAI;AAC/B;;;AAGA,OAAO,eAAeC,gBAAgB;EACpC,IAAI,CAACD,EAAE,EAAE;IACP,IAAI;MACFA,EAAE,GAAG,MAAM,MAAM,CAAC,aAAa,CAAC;KACjC,CAAC,OAAOhG,KAAK,EAAE;MACd,IAAIA,KAAK,YAAYkG,SAAS,EAAE;QAC9B,MAAM,IAAIjG,KAAK,CACb,4DAA4D,CAC7D;;MAEH,MAAMD,KAAK;;;EAGf,OAAOgG,EAAE;AACX;AAEA;;;AAGA,OAAO,eAAeG,mBAAmB,CACvCC,QAAkB,EAClBC,IAAa;EAEb,MAAMC,OAAO,GAAG,EAAE;EAClB,IAAID,IAAI,EAAE;IACR,MAAML,EAAE,GAAG,MAAMC,gBAAgB,EAAE;IACnC,MAAMM,UAAU,GAAG,MAAMP,EAAE,CAACQ,IAAI,CAACH,IAAI,EAAE,IAAI,CAAC;IAC5C,IAAI;MACF,WAAW,MAAMI,KAAK,IAAIL,QAAQ,EAAE;QAClCE,OAAO,CAAChF,IAAI,CAACmF,KAAK,CAAC;QACnB,MAAMF,UAAU,CAACG,SAAS,CAACD,KAAK,CAAC;;KAEpC,SAAS;MACR,MAAMF,UAAU,CAACI,KAAK,EAAE;;GAE3B,MAAM;IACL,WAAW,MAAMF,KAAK,IAAIL,QAAQ,EAAE;MAClCE,OAAO,CAAChF,IAAI,CAACmF,KAAK,CAAC;;;EAGvB,IAAI;IACF,OAAOG,MAAM,CAACC,MAAM,CAACP,OAAO,CAAC;GAC9B,CAAC,OAAOtG,KAAK,EAAE;IACd,OAAO,IAAI;;AAEf;AAEA;;;AAGA,OAAO,eAAe8G,6BAA6B,CACjDC,MAAkB,EAClBC,MAAc;EAEd;EACA;EACA,IAAI,CAACrI,MAAM,EAAE;IACX,MAAM,IAAIsB,KAAK,CAAC,wDAAwD,CAAC;;EAG3E,MAAM;IAACgH;EAAQ,CAAC,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC;EAEzC,IAAIC,GAAG,GAAG,KAAK;EACf,OAAO,IAAID,QAAQ,CAAC;IAClB,MAAME,IAAI,CAACxF,IAAY;MACrB,IAAIuF,GAAG,EAAE;QACP;;MAGF,IAAI;QACF,MAAME,QAAQ,GAAG,MAAML,MAAM,CAACM,IAAI,CAAC,SAAS,EAAE;UAACL,MAAM;UAAErF;QAAI,CAAC,CAAC;QAC7D,IAAI,CAACL,IAAI,CAAC8F,QAAQ,CAACE,IAAI,EAAEF,QAAQ,CAACG,aAAa,GAAG,QAAQ,GAAGnE,SAAS,CAAC;QACvE,IAAIgE,QAAQ,CAACF,GAAG,EAAE;UAChBA,GAAG,GAAG,IAAI;UACV,MAAMH,MAAM,CAACM,IAAI,CAAC,UAAU,EAAE;YAACL;UAAM,CAAC,CAAC;UACvC,IAAI,CAAC1F,IAAI,CAAC,IAAI,CAAC;;OAElB,CAAC,OAAOtB,KAAK,EAAE;QACd,IAAInB,WAAW,CAACmB,KAAK,CAAC,EAAE;UACtB,IAAI,CAACwH,OAAO,CAACxH,KAAK,CAAC;UACnB;;QAEF,MAAMA,KAAK;;IAEf;GACD,CAAC;AACJ;AAEA;;;AAGA,OAAO,eAAeyH,cAAc,CAClCC,IAA4B,EAC5BC,OAAe;EAEf;EACA;EACA,OAAO,MAAMD,IAAI,CAACE,QAAQ,CAACC,IAAI,IAAG;IAChCC,QAAQ,CAACtB,IAAI,EAAE;IACfsB,QAAQ,CAACC,KAAK,CAACF,IAAI,CAAC;IACpBC,QAAQ,CAACnB,KAAK,EAAE;EAClB,CAAC,EAAEgB,OAAO,CAAC;AACb;AAEA;;;AAGA,OAAM,SAAUK,cAAc;EAC5B,IAAIL,OAAO,GAAG,EAAE;EAChB,KAAK,MAAMM,IAAI,IAAIH,QAAQ,CAACI,UAAU,EAAE;IACtC,QAAQD,IAAI;MACV,KAAKH,QAAQ,CAACK,eAAe;QAC3BR,OAAO,IAAIG,QAAQ,CAACK,eAAe,CAACC,SAAS;QAC7C;MACF;QACET,OAAO,IAAI,IAAIU,aAAa,EAAE,CAACC,iBAAiB,CAACL,IAAI,CAAC;QACtD;IAAM;;EAIZ,OAAON,OAAO;AAChB;AAEA;;;AAGA,OAAM,SAAUY,kBAAkB,CAChChJ,IAAY;EAEZ,IAAIiJ,UAAU,GAAG,IAAI;EACrB,MAAMC,gBAAgB,GAAG,IAAIC,GAAG,CAAC,CAC/B,OAAO,EACP,SAAS,EACT,QAAQ,EACR,cAAc,CACf,CAAC;EAEF,IAAID,gBAAgB,CAACE,GAAG,CAACpJ,IAAI,CAAC,EAAE;IAC9BiJ,UAAU,GAAGjJ,IAAI;;EAEnBX,MAAM,CAAC4J,UAAU,EAAE,mCAAmCjJ,IAAI,EAAE,CAAC;EAC7D,OAAOiJ,UAA6D;AACtE;AAEA;;;AAGA,OAAM,SAAUI,OAAO,CAACC,EAAU;EAChC,OAAOA,EAAE,KAAK,CAAC,GACXzK,KAAK,GACLC,KAAK,CAACwK,EAAE,CAAC,CAACC,IAAI,CACZ3K,GAAG,CAAC,MAAK;IACP,MAAM,IAAIY,YAAY,CAAC,2BAA2B8J,EAAE,IAAI,CAAC;EAC3D,CAAC,CAAC,CACH;AACP;AAEA;;;AAGA,OAAO,MAAME,kBAAkB,GAAG,6BAA6B;AAE/D;;;AAGA,OAAO,MAAMC,gBAAgB,GAAG,6CAA6C;AAC7E;;;AAGA,OAAM,SAAUC,mBAAmB,CAACnI,GAAW;EAC7C,OAAO,iBAAiBA,GAAG,EAAE;AAC/B;AAEA;;;AAGA,OAAO,eAAeoI,WAAW,CAC/BC,cAAkD,EAClDC,SAAoB,EACpBC,cAAiE,EACjE;AACAR,EAAU,EACVS,WAA4B;EAE5B,OAAO,MAAMhL,cAAc,CAEvBC,SAAS,CAAC4K,cAAc,EAAEC,SAA8B,CACzD,CAACN,IAAI,CACJtK,WAAW,CAAC,MAAM+K,IAAI,IAAG;IACvB,IAAI3F,QAAQ,CAACyF,cAAc,CAAC,EAAE;MAC5B,OAAOA,cAAc,KAAKE,IAAI,CAACzI,GAAG,EAAE;;IAEtC,IAAI,OAAOuI,cAAc,KAAK,UAAU,EAAE;MACxC,OAAO,CAAC,EAAE,MAAMA,cAAc,CAACE,IAAI,CAAC,CAAC;;IAEvC,OAAO,KAAK;EACd,CAAC,CAAC,EACF7K,QAAQ,CAACkK,OAAO,CAACC,EAAE,CAAC,EAAEpK,IAAI,CAAC6K,WAAW,CAACE,YAAY,EAAE,CAAC,CAAC,CACxD,CACF;AACH;AAEA;;;AAGA,OAAO,MAAMC,iBAAiB,GAAG,GAAG","names":["map","NEVER","timer","firstValueFrom","fromEvent","filterAsync","from","raceWith","isNode","assert","isErrorLike","debug","TimeoutError","debugError","createEvaluationError","details","name","message","exception","text","type","subtype","objectId","valueFromRemoteObject","detail","getErrorDetails","messageHeight","split","length","error","Error","stackLines","stack","messageLines","splice","shift","stackTrace","stackTraceLimit","frame","callFrames","reverse","PuppeteerURL","isPuppeteerURL","url","INTERNAL_URL","parse","unshift","functionName","siteString","lineNumber","columnNumber","push","join","createClientError","lines","description","size","Math","min","className","startsWith","slice","SOURCE_URL","Symbol","fromCallSite","site","toString","puppeteerUrl","decodeURIComponent","encodeURIComponent","withSourcePuppeteerURLIfNone","object","Object","prototype","hasOwnProperty","call","original","prepareStackTrace","_","assign","getSourcePuppeteerURLIfAvailable","undefined","remoteObject","unserializableValue","BigInt","replace","NaN","Infinity","value","isString","obj","String","isNumber","Number","isPlainObject","constructor","isRegExp","RegExp","isDate","Date","evaluationString","fun","args","serializeArgument","arg","is","JSON","stringify","addPageBinding","callCdp","globalThis","callPuppeteer","Map","callbacks","seq","lastSeq","set","isTrivial","some","Node","Promise","resolve","reject","delete","pageBindingInitString","fs","importFSPromises","TypeError","getReadableAsBuffer","readable","path","buffers","fileHandle","open","chunk","writeFile","close","Buffer","concat","getReadableFromProtocolStream","client","handle","Readable","eof","read","response","send","data","base64Encoded","destroy","setPageContent","page","content","evaluate","html","document","write","getPageContent","node","childNodes","documentElement","outerHTML","XMLSerializer","serializeToString","validateDialogType","dialogType","validDialogTypes","Set","has","timeout","ms","pipe","UTILITY_WORLD_NAME","SOURCE_URL_REGEX","getSourceUrlComment","waitForHTTP","networkManager","eventName","urlOrPredicate","cancelation","http","valueOrThrow","NETWORK_IDLE_TIME"],"sources":["D:\\Julieth-Campos\\PSO\\node_modules\\puppeteer-core\\src\\common\\util.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type FS from 'fs/promises';\nimport type {Readable} from 'stream';\n\nimport type {Protocol} from 'devtools-protocol';\n\nimport {\n  map,\n  NEVER,\n  timer,\n  type Observable,\n  firstValueFrom,\n  fromEvent,\n  filterAsync,\n  from,\n  raceWith,\n} from '../../third_party/rxjs/rxjs.js';\nimport type {CDPSession} from '../api/CDPSession.js';\nimport type {Page} from '../api/Page.js';\nimport {isNode} from '../environment.js';\nimport {assert} from '../util/assert.js';\nimport type {Deferred} from '../util/Deferred.js';\nimport {isErrorLike} from '../util/ErrorLike.js';\n\nimport {debug} from './Debug.js';\nimport {TimeoutError} from './Errors.js';\nimport type {EventEmitter, EventType} from './EventEmitter.js';\nimport type {NetworkManagerEvents} from './NetworkManagerEvents.js';\n\n/**\n * @internal\n */\nexport const debugError = debug('puppeteer:error');\n\n/**\n * @internal\n */\nexport function createEvaluationError(\n  details: Protocol.Runtime.ExceptionDetails\n): unknown {\n  let name: string;\n  let message: string;\n  if (!details.exception) {\n    name = 'Error';\n    message = details.text;\n  } else if (\n    (details.exception.type !== 'object' ||\n      details.exception.subtype !== 'error') &&\n    !details.exception.objectId\n  ) {\n    return valueFromRemoteObject(details.exception);\n  } else {\n    const detail = getErrorDetails(details);\n    name = detail.name;\n    message = detail.message;\n  }\n  const messageHeight = message.split('\\n').length;\n  const error = new Error(message);\n  error.name = name;\n  const stackLines = error.stack!.split('\\n');\n  const messageLines = stackLines.splice(0, messageHeight);\n\n  // The first line is this function which we ignore.\n  stackLines.shift();\n  if (details.stackTrace && stackLines.length < Error.stackTraceLimit) {\n    for (const frame of details.stackTrace.callFrames.reverse()) {\n      if (\n        PuppeteerURL.isPuppeteerURL(frame.url) &&\n        frame.url !== PuppeteerURL.INTERNAL_URL\n      ) {\n        const url = PuppeteerURL.parse(frame.url);\n        stackLines.unshift(\n          `    at ${frame.functionName || url.functionName} (${\n            url.functionName\n          } at ${url.siteString}, <anonymous>:${frame.lineNumber}:${\n            frame.columnNumber\n          })`\n        );\n      } else {\n        stackLines.push(\n          `    at ${frame.functionName || '<anonymous>'} (${frame.url}:${\n            frame.lineNumber\n          }:${frame.columnNumber})`\n        );\n      }\n      if (stackLines.length >= Error.stackTraceLimit) {\n        break;\n      }\n    }\n  }\n\n  error.stack = [...messageLines, ...stackLines].join('\\n');\n  return error;\n}\n\n/**\n * @internal\n */\nexport function createClientError(\n  details: Protocol.Runtime.ExceptionDetails\n): Error {\n  let name: string;\n  let message: string;\n  if (!details.exception) {\n    name = 'Error';\n    message = details.text;\n  } else if (\n    (details.exception.type !== 'object' ||\n      details.exception.subtype !== 'error') &&\n    !details.exception.objectId\n  ) {\n    return valueFromRemoteObject(details.exception);\n  } else {\n    const detail = getErrorDetails(details);\n    name = detail.name;\n    message = detail.message;\n  }\n  const error = new Error(message);\n  error.name = name;\n\n  const messageHeight = error.message.split('\\n').length;\n  const messageLines = error.stack!.split('\\n').splice(0, messageHeight);\n\n  const stackLines = [];\n  if (details.stackTrace) {\n    for (const frame of details.stackTrace.callFrames) {\n      // Note we need to add `1` because the values are 0-indexed.\n      stackLines.push(\n        `    at ${frame.functionName || '<anonymous>'} (${frame.url}:${\n          frame.lineNumber + 1\n        }:${frame.columnNumber + 1})`\n      );\n      if (stackLines.length >= Error.stackTraceLimit) {\n        break;\n      }\n    }\n  }\n\n  error.stack = [...messageLines, ...stackLines].join('\\n');\n  return error;\n}\n\nconst getErrorDetails = (details: Protocol.Runtime.ExceptionDetails) => {\n  let name = '';\n  let message: string;\n  const lines = details.exception?.description?.split('\\n    at ') ?? [];\n  const size = Math.min(\n    details.stackTrace?.callFrames.length ?? 0,\n    lines.length - 1\n  );\n  lines.splice(-size, size);\n  if (details.exception?.className) {\n    name = details.exception.className;\n  }\n  message = lines.join('\\n');\n  if (name && message.startsWith(`${name}: `)) {\n    message = message.slice(name.length + 2);\n  }\n  return {message, name};\n};\n\n/**\n * @internal\n */\nconst SOURCE_URL = Symbol('Source URL for Puppeteer evaluation scripts');\n\n/**\n * @internal\n */\nexport class PuppeteerURL {\n  static INTERNAL_URL = 'pptr:internal';\n\n  static fromCallSite(\n    functionName: string,\n    site: NodeJS.CallSite\n  ): PuppeteerURL {\n    const url = new PuppeteerURL();\n    url.#functionName = functionName;\n    url.#siteString = site.toString();\n    return url;\n  }\n\n  static parse = (url: string): PuppeteerURL => {\n    url = url.slice('pptr:'.length);\n    const [functionName = '', siteString = ''] = url.split(';');\n    const puppeteerUrl = new PuppeteerURL();\n    puppeteerUrl.#functionName = functionName;\n    puppeteerUrl.#siteString = decodeURIComponent(siteString);\n    return puppeteerUrl;\n  };\n\n  static isPuppeteerURL = (url: string): boolean => {\n    return url.startsWith('pptr:');\n  };\n\n  #functionName!: string;\n  #siteString!: string;\n\n  get functionName(): string {\n    return this.#functionName;\n  }\n\n  get siteString(): string {\n    return this.#siteString;\n  }\n\n  toString(): string {\n    return `pptr:${[\n      this.#functionName,\n      encodeURIComponent(this.#siteString),\n    ].join(';')}`;\n  }\n}\n\n/**\n * @internal\n */\nexport const withSourcePuppeteerURLIfNone = <T extends NonNullable<unknown>>(\n  functionName: string,\n  object: T\n): T => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object;\n  }\n  const original = Error.prepareStackTrace;\n  Error.prepareStackTrace = (_, stack) => {\n    // First element is the function.\n    // Second element is the caller of this function.\n    // Third element is the caller of the caller of this function\n    // which is precisely what we want.\n    return stack[2];\n  };\n  const site = new Error().stack as unknown as NodeJS.CallSite;\n  Error.prepareStackTrace = original;\n  return Object.assign(object, {\n    [SOURCE_URL]: PuppeteerURL.fromCallSite(functionName, site),\n  });\n};\n\n/**\n * @internal\n */\nexport const getSourcePuppeteerURLIfAvailable = <\n  T extends NonNullable<unknown>,\n>(\n  object: T\n): PuppeteerURL | undefined => {\n  if (Object.prototype.hasOwnProperty.call(object, SOURCE_URL)) {\n    return object[SOURCE_URL as keyof T] as PuppeteerURL;\n  }\n  return undefined;\n};\n\n/**\n * @internal\n */\nexport function valueFromRemoteObject(\n  remoteObject: Protocol.Runtime.RemoteObject\n): any {\n  assert(!remoteObject.objectId, 'Cannot extract value when objectId is given');\n  if (remoteObject.unserializableValue) {\n    if (remoteObject.type === 'bigint') {\n      return BigInt(remoteObject.unserializableValue.replace('n', ''));\n    }\n    switch (remoteObject.unserializableValue) {\n      case '-0':\n        return -0;\n      case 'NaN':\n        return NaN;\n      case 'Infinity':\n        return Infinity;\n      case '-Infinity':\n        return -Infinity;\n      default:\n        throw new Error(\n          'Unsupported unserializable value: ' +\n            remoteObject.unserializableValue\n        );\n    }\n  }\n  return remoteObject.value;\n}\n\n/**\n * @internal\n */\nexport const isString = (obj: unknown): obj is string => {\n  return typeof obj === 'string' || obj instanceof String;\n};\n\n/**\n * @internal\n */\nexport const isNumber = (obj: unknown): obj is number => {\n  return typeof obj === 'number' || obj instanceof Number;\n};\n\n/**\n * @internal\n */\nexport const isPlainObject = (obj: unknown): obj is Record<any, unknown> => {\n  return typeof obj === 'object' && obj?.constructor === Object;\n};\n\n/**\n * @internal\n */\nexport const isRegExp = (obj: unknown): obj is RegExp => {\n  return typeof obj === 'object' && obj?.constructor === RegExp;\n};\n\n/**\n * @internal\n */\nexport const isDate = (obj: unknown): obj is Date => {\n  return typeof obj === 'object' && obj?.constructor === Date;\n};\n\n/**\n * @internal\n */\nexport function evaluationString(\n  fun: Function | string,\n  ...args: unknown[]\n): string {\n  if (isString(fun)) {\n    assert(args.length === 0, 'Cannot evaluate a string with arguments');\n    return fun;\n  }\n\n  function serializeArgument(arg: unknown): string {\n    if (Object.is(arg, undefined)) {\n      return 'undefined';\n    }\n    return JSON.stringify(arg);\n  }\n\n  return `(${fun})(${args.map(serializeArgument).join(',')})`;\n}\n\n/**\n * @internal\n */\nexport function addPageBinding(type: string, name: string): void {\n  // This is the CDP binding.\n  // @ts-expect-error: In a different context.\n  const callCdp = globalThis[name];\n\n  // We replace the CDP binding with a Puppeteer binding.\n  Object.assign(globalThis, {\n    [name](...args: unknown[]): Promise<unknown> {\n      // This is the Puppeteer binding.\n      // @ts-expect-error: In a different context.\n      const callPuppeteer = globalThis[name];\n      callPuppeteer.args ??= new Map();\n      callPuppeteer.callbacks ??= new Map();\n\n      const seq = (callPuppeteer.lastSeq ?? 0) + 1;\n      callPuppeteer.lastSeq = seq;\n      callPuppeteer.args.set(seq, args);\n\n      callCdp(\n        JSON.stringify({\n          type,\n          name,\n          seq,\n          args,\n          isTrivial: !args.some(value => {\n            return value instanceof Node;\n          }),\n        })\n      );\n\n      return new Promise((resolve, reject) => {\n        callPuppeteer.callbacks.set(seq, {\n          resolve(value: unknown) {\n            callPuppeteer.args.delete(seq);\n            resolve(value);\n          },\n          reject(value?: unknown) {\n            callPuppeteer.args.delete(seq);\n            reject(value);\n          },\n        });\n      });\n    },\n  });\n}\n\n/**\n * @internal\n */\nexport function pageBindingInitString(type: string, name: string): string {\n  return evaluationString(addPageBinding, type, name);\n}\n\n/**\n * @internal\n */\nlet fs: typeof FS | null = null;\n/**\n * @internal\n */\nexport async function importFSPromises(): Promise<typeof FS> {\n  if (!fs) {\n    try {\n      fs = await import('fs/promises');\n    } catch (error) {\n      if (error instanceof TypeError) {\n        throw new Error(\n          'Cannot write to a path outside of a Node-like environment.'\n        );\n      }\n      throw error;\n    }\n  }\n  return fs;\n}\n\n/**\n * @internal\n */\nexport async function getReadableAsBuffer(\n  readable: Readable,\n  path?: string\n): Promise<Buffer | null> {\n  const buffers = [];\n  if (path) {\n    const fs = await importFSPromises();\n    const fileHandle = await fs.open(path, 'w+');\n    try {\n      for await (const chunk of readable) {\n        buffers.push(chunk);\n        await fileHandle.writeFile(chunk);\n      }\n    } finally {\n      await fileHandle.close();\n    }\n  } else {\n    for await (const chunk of readable) {\n      buffers.push(chunk);\n    }\n  }\n  try {\n    return Buffer.concat(buffers);\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * @internal\n */\nexport async function getReadableFromProtocolStream(\n  client: CDPSession,\n  handle: string\n): Promise<Readable> {\n  // TODO: Once Node 18 becomes the lowest supported version, we can migrate to\n  // ReadableStream.\n  if (!isNode) {\n    throw new Error('Cannot create a stream outside of Node.js environment.');\n  }\n\n  const {Readable} = await import('stream');\n\n  let eof = false;\n  return new Readable({\n    async read(size: number) {\n      if (eof) {\n        return;\n      }\n\n      try {\n        const response = await client.send('IO.read', {handle, size});\n        this.push(response.data, response.base64Encoded ? 'base64' : undefined);\n        if (response.eof) {\n          eof = true;\n          await client.send('IO.close', {handle});\n          this.push(null);\n        }\n      } catch (error) {\n        if (isErrorLike(error)) {\n          this.destroy(error);\n          return;\n        }\n        throw error;\n      }\n    },\n  });\n}\n\n/**\n * @internal\n */\nexport async function setPageContent(\n  page: Pick<Page, 'evaluate'>,\n  content: string\n): Promise<void> {\n  // We rely upon the fact that document.open() will reset frame lifecycle with \"init\"\n  // lifecycle event. @see https://crrev.com/608658\n  return await page.evaluate(html => {\n    document.open();\n    document.write(html);\n    document.close();\n  }, content);\n}\n\n/**\n * @internal\n */\nexport function getPageContent(): string {\n  let content = '';\n  for (const node of document.childNodes) {\n    switch (node) {\n      case document.documentElement:\n        content += document.documentElement.outerHTML;\n        break;\n      default:\n        content += new XMLSerializer().serializeToString(node);\n        break;\n    }\n  }\n\n  return content;\n}\n\n/**\n * @internal\n */\nexport function validateDialogType(\n  type: string\n): 'alert' | 'confirm' | 'prompt' | 'beforeunload' {\n  let dialogType = null;\n  const validDialogTypes = new Set([\n    'alert',\n    'confirm',\n    'prompt',\n    'beforeunload',\n  ]);\n\n  if (validDialogTypes.has(type)) {\n    dialogType = type;\n  }\n  assert(dialogType, `Unknown javascript dialog type: ${type}`);\n  return dialogType as 'alert' | 'confirm' | 'prompt' | 'beforeunload';\n}\n\n/**\n * @internal\n */\nexport function timeout(ms: number): Observable<never> {\n  return ms === 0\n    ? NEVER\n    : timer(ms).pipe(\n        map(() => {\n          throw new TimeoutError(`Timed out after waiting ${ms}ms`);\n        })\n      );\n}\n\n/**\n * @internal\n */\nexport const UTILITY_WORLD_NAME = '__puppeteer_utility_world__';\n\n/**\n * @internal\n */\nexport const SOURCE_URL_REGEX = /^[\\040\\t]*\\/\\/[@#] sourceURL=\\s*(\\S*?)\\s*$/m;\n/**\n * @internal\n */\nexport function getSourceUrlComment(url: string): string {\n  return `//# sourceURL=${url}`;\n}\n\n/**\n * @internal\n */\nexport async function waitForHTTP<T extends {url(): string}>(\n  networkManager: EventEmitter<NetworkManagerEvents>,\n  eventName: EventType,\n  urlOrPredicate: string | ((res: T) => boolean | Promise<boolean>),\n  /** Time after the function will timeout */\n  ms: number,\n  cancelation: Deferred<never>\n): Promise<T> {\n  return await firstValueFrom(\n    (\n      fromEvent(networkManager, eventName as unknown as string) as Observable<T>\n    ).pipe(\n      filterAsync(async http => {\n        if (isString(urlOrPredicate)) {\n          return urlOrPredicate === http.url();\n        }\n        if (typeof urlOrPredicate === 'function') {\n          return !!(await urlOrPredicate(http));\n        }\n        return false;\n      }),\n      raceWith(timeout(ms), from(cancelation.valueOrThrow()))\n    )\n  );\n}\n\n/**\n * @internal\n */\nexport const NETWORK_IDLE_TIME = 500;\n"]},"metadata":{},"sourceType":"module"}