{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Explorer = void 0;\nconst promises_1 = __importDefault(require(\"fs/promises\"));\nconst path_1 = __importDefault(require(\"path\"));\nconst path_type_1 = require(\"path-type\");\nconst ExplorerBase_js_1 = require(\"./ExplorerBase.js\");\nconst loaders_js_1 = require(\"./loaders.js\");\nconst util_js_1 = require(\"./util.js\");\n/**\n * @internal\n */\nclass Explorer extends ExplorerBase_js_1.ExplorerBase {\n  async load(filepath) {\n    filepath = path_1.default.resolve(filepath);\n    const load = async () => {\n      return await this.config.transform(await this.#readConfiguration(filepath));\n    };\n    if (this.loadCache) {\n      return await (0, util_js_1.emplace)(this.loadCache, filepath, load);\n    }\n    return await load();\n  }\n  async search() {\n    let from = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    if (this.config.metaConfigFilePath) {\n      this.loadingMetaConfig = true;\n      const config = await this.load(this.config.metaConfigFilePath);\n      this.loadingMetaConfig = false;\n      if (config && !config.isEmpty) {\n        return config;\n      }\n    }\n    const stopDir = path_1.default.resolve(this.config.stopDir);\n    from = path_1.default.resolve(from);\n    const search = async () => {\n      /* istanbul ignore if -- @preserve */\n      if (await (0, path_type_1.isDirectory)(from)) {\n        for (const place of this.config.searchPlaces) {\n          const filepath = path_1.default.join(from, place);\n          try {\n            const result = await this.#readConfiguration(filepath);\n            if (result !== null && !(result.isEmpty && this.config.ignoreEmptySearchPlaces)) {\n              return await this.config.transform(result);\n            }\n          } catch (error) {\n            if (error.code === 'ENOENT' || error.code === 'EISDIR' || error.code === 'ENOTDIR') {\n              continue;\n            }\n            throw error;\n          }\n        }\n      }\n      const dir = path_1.default.dirname(from);\n      if (from !== stopDir && from !== dir) {\n        from = dir;\n        if (this.searchCache) {\n          return await (0, util_js_1.emplace)(this.searchCache, from, search);\n        }\n        return await search();\n      }\n      return await this.config.transform(null);\n    };\n    if (this.searchCache) {\n      return await (0, util_js_1.emplace)(this.searchCache, from, search);\n    }\n    return await search();\n  }\n  async #readConfiguration(filepath) {\n    const contents = await promises_1.default.readFile(filepath, {\n      encoding: 'utf-8'\n    });\n    return this.toCosmiconfigResult(filepath, await this.#loadConfiguration(filepath, contents));\n  }\n  async #loadConfiguration(filepath, contents) {\n    if (contents.trim() === '') {\n      return;\n    }\n    if (path_1.default.basename(filepath) === 'package.json') {\n      return (0, util_js_1.getPropertyByPath)((0, loaders_js_1.loadJson)(filepath, contents), this.config.packageProp) ?? null;\n    }\n    const extension = path_1.default.extname(filepath);\n    try {\n      const loader = this.config.loaders[extension || 'noExt'] ?? this.config.loaders['default'];\n      if (loader !== undefined) {\n        // eslint-disable-next-line @typescript-eslint/return-await\n        return await loader(filepath, contents);\n      }\n    } catch (error) {\n      error.filepath = filepath;\n      throw error;\n    }\n    throw new Error(`No loader specified for ${(0, ExplorerBase_js_1.getExtensionDescription)(extension)}`);\n  }\n}\nexports.Explorer = Explorer;","map":{"version":3,"mappings":"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","names":["Explorer","ExplorerBase_js_1","load","filepath","path_1","resolve","config","transform","loadCache","search","from","metaConfigFilePath","loadingMetaConfig","isEmpty","stopDir","place","searchPlaces","join","result","ignoreEmptySearchPlaces","error","code","dir","dirname","searchCache","contents","promises_1","readFile","encoding","toCosmiconfigResult","trim","basename","packageProp","extension","extname","loader","loaders","undefined","Error","exports"],"sources":["../src/Explorer.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}