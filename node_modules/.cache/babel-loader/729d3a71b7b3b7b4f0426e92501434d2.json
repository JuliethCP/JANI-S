{"ast":null,"code":"import { getReadableAsBuffer, getReadableFromProtocolStream } from '../common/util.js';\nimport { assert } from '../util/assert.js';\nimport { Deferred } from '../util/Deferred.js';\nimport { isErrorLike } from '../util/ErrorLike.js';\n/**\n * The Tracing class exposes the tracing audit interface.\n * @remarks\n * You can use `tracing.start` and `tracing.stop` to create a trace file\n * which can be opened in Chrome DevTools or {@link https://chromedevtools.github.io/timeline-viewer/ | timeline viewer}.\n *\n * @example\n *\n * ```ts\n * await page.tracing.start({path: 'trace.json'});\n * await page.goto('https://www.google.com');\n * await page.tracing.stop();\n * ```\n *\n * @public\n */\nexport class Tracing {\n  #client;\n  #recording = false;\n  #path;\n  /**\n   * @internal\n   */\n  constructor(client) {\n    this.#client = client;\n  }\n  /**\n   * @internal\n   */\n  updateClient(client) {\n    this.#client = client;\n  }\n  /**\n   * Starts a trace for the current page.\n   * @remarks\n   * Only one trace can be active at a time per browser.\n   *\n   * @param options - Optional `TracingOptions`.\n   */\n  async start() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    assert(!this.#recording, 'Cannot start recording trace while already recording trace.');\n    const defaultCategories = ['-*', 'devtools.timeline', 'v8.execute', 'disabled-by-default-devtools.timeline', 'disabled-by-default-devtools.timeline.frame', 'toplevel', 'blink.console', 'blink.user_timing', 'latencyInfo', 'disabled-by-default-devtools.timeline.stack', 'disabled-by-default-v8.cpu_profiler'];\n    const {\n      path,\n      screenshots = false,\n      categories = defaultCategories\n    } = options;\n    if (screenshots) {\n      categories.push('disabled-by-default-devtools.screenshot');\n    }\n    const excludedCategories = categories.filter(cat => {\n      return cat.startsWith('-');\n    }).map(cat => {\n      return cat.slice(1);\n    });\n    const includedCategories = categories.filter(cat => {\n      return !cat.startsWith('-');\n    });\n    this.#path = path;\n    this.#recording = true;\n    await this.#client.send('Tracing.start', {\n      transferMode: 'ReturnAsStream',\n      traceConfig: {\n        excludedCategories,\n        includedCategories\n      }\n    });\n  }\n  /**\n   * Stops a trace started with the `start` method.\n   * @returns Promise which resolves to buffer with trace data.\n   */\n  async stop() {\n    const contentDeferred = Deferred.create();\n    this.#client.once('Tracing.tracingComplete', async event => {\n      try {\n        assert(event.stream, 'Missing \"stream\"');\n        const readable = await getReadableFromProtocolStream(this.#client, event.stream);\n        const buffer = await getReadableAsBuffer(readable, this.#path);\n        contentDeferred.resolve(buffer ?? undefined);\n      } catch (error) {\n        if (isErrorLike(error)) {\n          contentDeferred.reject(error);\n        } else {\n          contentDeferred.reject(new Error(`Unknown error: ${error}`));\n        }\n      }\n    });\n    await this.#client.send('Tracing.end');\n    this.#recording = false;\n    return await contentDeferred.valueOrThrow();\n  }\n}","map":{"version":3,"mappings":"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","names":["getReadableAsBuffer","getReadableFromProtocolStream","assert","Deferred","isErrorLike","Tracing","constructor","client","updateClient","start","options","defaultCategories","path","screenshots","categories","push","excludedCategories","filter","cat","startsWith","map","slice","includedCategories","send","transferMode","traceConfig","stop","contentDeferred","create","once","event","stream","readable","buffer","resolve","undefined","error","reject","Error","valueOrThrow"],"sources":["D:\\Julieth-Campos\\PSO\\node_modules\\puppeteer-core\\src\\cdp\\Tracing.ts"],"sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type {CDPSession} from '../api/CDPSession.js';\nimport {\n  getReadableAsBuffer,\n  getReadableFromProtocolStream,\n} from '../common/util.js';\nimport {assert} from '../util/assert.js';\nimport {Deferred} from '../util/Deferred.js';\nimport {isErrorLike} from '../util/ErrorLike.js';\n\n/**\n * @public\n */\nexport interface TracingOptions {\n  path?: string;\n  screenshots?: boolean;\n  categories?: string[];\n}\n\n/**\n * The Tracing class exposes the tracing audit interface.\n * @remarks\n * You can use `tracing.start` and `tracing.stop` to create a trace file\n * which can be opened in Chrome DevTools or {@link https://chromedevtools.github.io/timeline-viewer/ | timeline viewer}.\n *\n * @example\n *\n * ```ts\n * await page.tracing.start({path: 'trace.json'});\n * await page.goto('https://www.google.com');\n * await page.tracing.stop();\n * ```\n *\n * @public\n */\nexport class Tracing {\n  #client: CDPSession;\n  #recording = false;\n  #path?: string;\n\n  /**\n   * @internal\n   */\n  constructor(client: CDPSession) {\n    this.#client = client;\n  }\n\n  /**\n   * @internal\n   */\n  updateClient(client: CDPSession): void {\n    this.#client = client;\n  }\n\n  /**\n   * Starts a trace for the current page.\n   * @remarks\n   * Only one trace can be active at a time per browser.\n   *\n   * @param options - Optional `TracingOptions`.\n   */\n  async start(options: TracingOptions = {}): Promise<void> {\n    assert(\n      !this.#recording,\n      'Cannot start recording trace while already recording trace.'\n    );\n\n    const defaultCategories = [\n      '-*',\n      'devtools.timeline',\n      'v8.execute',\n      'disabled-by-default-devtools.timeline',\n      'disabled-by-default-devtools.timeline.frame',\n      'toplevel',\n      'blink.console',\n      'blink.user_timing',\n      'latencyInfo',\n      'disabled-by-default-devtools.timeline.stack',\n      'disabled-by-default-v8.cpu_profiler',\n    ];\n    const {path, screenshots = false, categories = defaultCategories} = options;\n\n    if (screenshots) {\n      categories.push('disabled-by-default-devtools.screenshot');\n    }\n\n    const excludedCategories = categories\n      .filter(cat => {\n        return cat.startsWith('-');\n      })\n      .map(cat => {\n        return cat.slice(1);\n      });\n    const includedCategories = categories.filter(cat => {\n      return !cat.startsWith('-');\n    });\n\n    this.#path = path;\n    this.#recording = true;\n    await this.#client.send('Tracing.start', {\n      transferMode: 'ReturnAsStream',\n      traceConfig: {\n        excludedCategories,\n        includedCategories,\n      },\n    });\n  }\n\n  /**\n   * Stops a trace started with the `start` method.\n   * @returns Promise which resolves to buffer with trace data.\n   */\n  async stop(): Promise<Buffer | undefined> {\n    const contentDeferred = Deferred.create<Buffer | undefined>();\n    this.#client.once('Tracing.tracingComplete', async event => {\n      try {\n        assert(event.stream, 'Missing \"stream\"');\n        const readable = await getReadableFromProtocolStream(\n          this.#client,\n          event.stream\n        );\n        const buffer = await getReadableAsBuffer(readable, this.#path);\n        contentDeferred.resolve(buffer ?? undefined);\n      } catch (error) {\n        if (isErrorLike(error)) {\n          contentDeferred.reject(error);\n        } else {\n          contentDeferred.reject(new Error(`Unknown error: ${error}`));\n        }\n      }\n    });\n    await this.#client.send('Tracing.end');\n    this.#recording = false;\n    return await contentDeferred.valueOrThrow();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}